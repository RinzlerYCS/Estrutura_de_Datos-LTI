
            while True:
                print('\nESTADISTICAS\n1. Servicios más prestados\n2. Clientes con más notas\n3. Promdeio de los montos de las notas\n4. Volver al menú principal')
                try:
                    opciones = int(input('Selecciona una opción en el submenú: '))
                except ValueError:
                    print("Por favor, ingrese un número válido.")
                    continue
                match opciones:
                    case 1:
                        while True:   #CONSULTA POR PERIODO
                            try:
                                cantidad_d_servicios_a_mostrar=int(input("¿Cuantos servicios desea consultar?"))
                                if cantidad_d_servicios_a_mostrar <1:
                                  print('Tiene que elegir al menos un valor')
                                  continue
                            except ValueError:
                                print("Tiene que ingresar un dato numerico")
                                continue
                            try:
                                fecha_inicio = input("Ingrese la fecha inicial del período, en formato dd/mm/aaaa:\n")
                                if fecha_inicio.strip() == "":
                                  print("Se tomara la fecha predeterminada como 01/01/2000")
                                  fecha_inicio ="1/1/2000"
                                fecha_inicio = dt.datetime.strptime(fecha_inicio, "%d/%m/%Y").date()
                                if fecha_inicio>fecha_actual:            #SE VERIFICA QUE LA FECHA NO SEA posterior A LA ACTUAL
                                  print("La fecha que usted ingreso es invalida, su fecha no debe ser posterior a la actual")
                                  continue
                            except ValueError:
                                print("El dato ingresado no cumple con el patrón (dd/mm/aaaa)")
                                continue

                            try:
                                fecha_final = input("Ingrese la fecha final del período, en formato dd/mm/aaaa:\n")
                                if fecha_final.strip() == "":###validar que sea posterior
                                  print("No se ingreso nada, por lo tanto la fecha predetermianda es la fecha actual")
                                  fecha_final =dt.date.today()
                                else:
                                  fecha_final = dt.datetime.strptime(fecha_final, "%d/%m/%Y").date()
                            except ValueError:
                                print("El dato ingresado no cumple con el patrón (dd/mm/aaaa)")
                                continue

                            try:
                                with sqlite3.connect("TallerMecanico (3).db") as conn:
                                  my_cursor=conn.cursor()
                                  mayores_servicios={"fechainicio":fecha_inicio,
                                                     "fechafinal":fecha_final,
                                                     "cantidad_a_mostrar":cantidad_d_servicios_a_mostrar}
                                  my_cursor.execute('SELECT S.nombre_servicio,COUNT(D.clave_servicio) as Cantidad\
                                                      FROM Detalles D INNER JOIN Servicios S ON D.clave_servicio=S.clave_servicio\
                                                      INNER JOIN Notas N ON N.folio=D.folio\
                                                      WHERE  N.fecha BETWEEN :fechainicio AND :fechafinal\
                                                      GROUP BY D.clave_servicio\
                                                      ORDER BY D.clave_servicio ASC\
                                                      LIMIT :cantidad_a_mostrar',mayores_servicios)

                                  muestra=my_cursor.fetchall()
                                  print('Servicio\t Cantidad')
                                  print("-"*30)
                                  for a,b in muestra:
                                      print(f'{a}\t{b}')
                                  while True:
                                    print('Donde deseas guardar el arvhivo\n 1. CSV \n2. Excel\n3. Salir')
                                    try:
                                        opcionarchivoes= int(input('Selecciona una opción en el submenú: '))
                                    except ValueError:
                                        print("Por favor, ingrese solo números .")
                                        continue
                                    match opcionarchivoes:
                                        case 1:
                                            nombre_archivocsv= f"ReporteServiciosMasPrestados_{fecha_inicio}_{fecha_final}.csv"
                                            with open(nombre_archivocsv, mode='w', newline='') as archivo_csv:
                                                escritor_csv = csv.writer(archivo_csv)
                                                escritor_csv.writerow(['Servicio', 'Cantidad'])
                                                for fila in muestra:
                                                    escritor_csv.writerow(fila)
                                                    break
                                        case 2:
                                            nombre_archivo_xlsx = f"ReporteServiciosMasPrestados_{fecha_inicio}_{fecha_final}.xlsx"
                                            workbook = Workbook()
                                            sheet = workbook.active
                                            sheet.append(['Nombre del Servicio', 'Cantidad'])
                                            for fila in muestra:
                                                sheet.append(fila)
                                                workbook.save(nombre_archivo_xlsx)
                                                print(f"Los datos se han guardado en el archivo Excel '{nombre_archivo_xlsx}'.")
                                        case 3:
                                            break
                                        case _:
                                            print("Opción no válida")
                            except Error as e:
                                print(e)
                            except ValueError:
                                print("")
                                break
                    case 2:
                        print("\nClientes con más notas")
                        try:
                            cantidad_clientes=int(input("Ingresa cuantos clientes quieres que se muestren (la cantidad minima es 1)"))
                        except ValueError:
                            print("Por favor, ingrese un número válido.")
                            continue
                        try:
                            fecha_inicio = input("Ingrese la fecha inicial del período, en formato dd/mm/aaaa:\n")
                            if fecha_inicio.strip() == "":
                                print("Se tomara la fecha predeterminada como 01/01/2000")
                                fecha_inicio ="1/1/2000"
                            fecha_inicio = dt.datetime.strptime(fecha_inicio, "%d/%m/%Y").date()
                            if fecha_inicio>fecha_actual:
                                print("La fecha que usted ingreso es invalida, su fecha no debe ser posterior a la actual")
                                continue
                        except ValueError:
                                print("El dato ingresado no cumple con el patrón (dd/mm/aaaa)")
                                continue
                        try:
                            fecha_final = input("Ingrese la fecha final del período, en formato dd/mm/aaaa:\n")
                            if fecha_final.strip() == "":
                                print("No se ingreso nada, por lo tanto la fecha predetermianda es la fecha actual")
                                fecha_final =dt.date.today()
                            else:
                                fecha_final = dt.datetime.strptime(fecha_final, "%d/%m/%Y").date()
                        except ValueError:
                            print("El dato ingresado no cumple con el patrón (dd/mm/aaaa)")
                            continue
                        try:
                            with sqlite3.connect("TallerMecanico.db") as conn:
                                my_cursor=conn.cursor()
                                mayores_clientes={"fechainicio":fecha_inicio, "fechafinal":fecha_final, "cantidad_a_mostrar":cantidad_clientes}
                                my_cursor.execute('SELECT C.nombre ,COUNT(N.clave) as Cantidad FROM Cliente C INNER JOIN Notas N ON C.clave=N.clave\
                                                      WHERE  N.fecha BETWEEN :fechainicio AND :fechafinal\
                                                      GROUP BY N.clave\
                                                      ORDER BY N.clave DESC\
                                                      LIMIT :cantidad_a_mostrar',mayores_clientes)
                                muestra=my_cursor.fetchall()
                                print('Clientes\t Cantidad')
                                for a,b in muestra:
                                    print(f'{a}  \t{b}')
                                while True:
                                    print('Donde deseas guardar el arvhivo\n 1. CSV \n2. Excel\n3. Salir')
                                    try:
                                        opcionarchivoes= int(input('Selecciona una opción en el submenú: '))
                                    except ValueError:
                                        print("Por favor, ingrese solo números .")
                                        continue
                                    match opcionarchivoes:
                                        case 1:
                                            nombre_archivocsv= f"ReporteClientesConMasNotas_{fecha_inicio}_{fecha_final}.csv"
                                            with open(nombre_archivocsv, mode='w', newline='') as archivo_csv:
                                                escritor_csv = csv.writer(archivo_csv)
                                                escritor_csv.writerow(['Cliente', 'Cantidad'])
                                                for fila in muestra:
                                                    escritor_csv.writerow(fila)
                                                    break
                                        case 2:
                                            nombre_archivo_xlsx = f"ReporteClientesConMasNotas_{fecha_inicio}_{fecha_final}.xlsx"
                                            workbook = Workbook()
                                            sheet = workbook.active
                                            sheet.append(['Nombre del Servicio', 'Cantidad'])
                                            for fila in muestra:
                                                sheet.append(fila)
                                                workbook.save(nombre_archivo_xlsx)
                                                print(f"Los datos se han guardado en el archivo Excel '{nombre_archivo_xlsx}'.")
                                        case 3:
                                            break
                                        case _:
                                            print("Opción no válida")
                        except Error as e:
                            print(e)
                        except ValueError:
                            print("")
                            break
                    case 3:
